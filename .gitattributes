
test=> \dt+
                          关联列表
 架构模式 |    名称    |  类型  | 拥有者 |    大小    | 描述 
----------+------------+--------+--------+------------+------
 public   | customer   | 数据表 | test   | 18 MB      | 
 public   | district   | 数据表 | test   | 8192 bytes | 
 public   | history    | 数据表 | test   | 2552 kB    | 
 public   | item       | 数据表 | test   | 10192 kB   | 
 public   | new_order  | 数据表 | test   | 416 kB     | 
 public   | oorder     | 数据表 | test   | 1960 kB    | 
 public   | order_line | 数据表 | test   | 29 MB      | 
 public   | stock      | 数据表 | test   | 34 MB      | 
 public   | warehouse  | 数据表 | test   | 8192 bytes | 

test=> \dt+
                          关联列表
 架构模式 |    名称    |  类型  | 拥有者 |    大小    | 描述 
----------+------------+--------+--------+------------+------
 public   | customer   | 数据表 | test   | 18 MB      | 
 public   | district   | 数据表 | test   | 8192 bytes | 
 public   | history    | 数据表 | test   | 2552 kB    | 
 public   | item       | 数据表 | test   | 10192 kB   | 
 public   | new_order  | 数据表 | test   | 416 kB     | 
 public   | oorder     | 数据表 | test   | 1960 kB    | 
 public   | order_line | 数据表 | test   | 29 MB      | 
 public   | stock      | 数据表 | test   | 34 MB      | 
 public   | warehouse  | 数据表 | test   | 8192 bytes | 
(9 行记录)

c_w_id | c_d_id | c_id | c_discount | c_credit |     c_last      |     c_first     | c_credit_lim | c_balance | c_ytd_payment | c_payment_cnt | c_delivery_cnt |     c_street_1      |     c_street_2      |       c_city        | c_state |   c_zip   |     c_phone      |         c_since         | c_middle |                                                                                                                                                                                                                                                       c_data                                                                                                                                                                                                                                                        
--------+--------+------+------------+----------+-----------------+-----------------+--------------+-----------+---------------+---------------+----------------+---------------------+---------------------+---------------------+---------+-----------+------------------+-------------------------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      1 |      1 |    1 |     0.2292 | GC       | BARBARBAR       | cwytqomr    :

 c_w_id | c_d_id | c_id | c_discount | c_credit |     c_last      |     c_first     | c_credit_lim | c_balance | c_ytd_payment | c_payment_cnt | c_delivery_cnt |     c_street_1      |     c_street_2      |       c_city        | c_state |   c_zip   |     c_phone      |         c_since         | c_middle |                                                                                                                                                                                                                                                       c_data                                                                                                                                                                                                                                                        
--------+--------+------+------------+----------+-----------------+-----------------+--------------+-----------+---------------+---------------+----------------+---------------------+---------------------+---------------------+---------+-----------+------------------+-------------------------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      1 |      1 |    1 |     0.2292 | GC       | BARBARBAR       | cwytqomr    :


 w_id |   w_ytd   | w_tax  | w_name  |    w_street_1    |   w_street_2    |       w_city        | w_state |   w_zip   
------+-----------+--------+---------+------------------+-----------------+---------------------+---------+-----------
    1 | 300000.00 | 0.1687 | rbiegza | ejstatdqpjpdcwlm | epnwzlaprmnoeux | xrgofcjprrrjkhecyxo | DM      | 123456789
(1 行记录)

 w_id |   w_ytd   | w_tax  | w_name  |    w_street_1    |   w_street_2    |       w_city        | w_state |   w_zip   
------+-----------+--------+---------+------------------+-----------------+---------------------+---------+-----------
    1 | 300000.00 | 0.1687 | rbiegza | ejstatdqpjpdcwlm | epnwzlaprmnoeux | xrgofcjprrrjkhecyxo | DM      | 123456789
(1 行记录)


 d_w_id | d_id |  d_ytd   | d_tax  | d_next_o_id |  d_name   |     d_street_1      |     d_street_2      |       d_city       | d_state |   d_zip   
--------+------+----------+--------+-------------+-----------+---------------------+---------------------+--------------------+---------+-----------
      1 |    1 | 30000.00 | 0.1552 |        3001 | kzfkkmpd  | ygjnisnudg          | tckxthreohwveqvwbi  | lotxwjehvz         | TH      | 123456789
      1 |    2 | 30000.00 | 0.0122 |        3001 | crnki     | qxctuxcju           | uphcguvzeahb        | spvhbexuodxtexnp   | XR      | 123456789
      1 |    3 | 30000.00 | 0.1188 |        3001 | qdaewyw   | kfbnxvrbtzoteqjaxuv | eeiabratadimduaafpu | dbraguvqgvgbqin    | GD      | 123456789
      1 |    4 | 30000.00 | 0.0203 |        3001 | qjhllfore | qnxgujzjnk          | zauhaaiawp          | akefscbkd          | DT      | 123456789
      1 |    5 | 30000.00 | 0.1021 |        3001 | ktsusw    | ssmyesxrunluviddecq | tcimrdcwdebpcilrk   | uqzutabhhtksqk     | FP      | 123456789
      1 |    6 | 30000.00 | 0.0103 |        3001 | bchgvg    | aoxbwtlnuhlw        | ekevpcfjchru        | vjqqshkhoknudchfj  | AZ      | 123456789
      1 |    7 | 30000.00 | 0.1650 |        3001 | zghibn    | vfawnmetd           | dcmmylnszllbmhbwx   | snjkevkll          | VE      | 123456789
      1 |    8 | 30000.00 | 0.0165 |        3001 | vmqajf    | zhxahunwexxbakvhjvy | aipzwhdopilwt       | uwpmbibscobqvlak   | NX      | 123456789
      1 |    9 | 30000.00 | 0.1792 |        3001 | arqte     | dbigpwyqahrswnjqj   | dgipsjozngxiuibe    | iizakunnluqjseszzw | EJ      | 123456789
      1 |   10 | 30000.00 | 0.0347 |        3001 | pqdlosct  | icqchnjgnlskmpelu:

 d_w_id | d_id |  d_ytd   | d_tax  | d_next_o_id |  d_name   |     d_street_1      |     d_street_2      |   
    d_city       | d_state |   d_zip   
--------+------+----------+--------+-------------+-----------+------------------
---+---------------------+--------------------+---------+-----------
      1 |    1 | 30000.00 | 0.1552 |        3001 | kzfkkmpd  | ygjnisnudg          | tckxthreohwveqvwbi  | lotxwjehvz         | TH      | 123456789
      1 |    2 | 30000.00 | 0.0122 |        3001 | crnki     | qxctuxcju           | uphcguvzeahb        | spvhbexuodxtexnp   | XR      | 123456789
      1 |    3 | 30000.00 | 0.1188 |        3001 | qdaewyw   | kfbnxvrbtzoteqjaxuv | eeiabratadimduaafpu | dbraguvqgvgbqin    | GD      | 123456789
      1 |    4 | 30000.00 | 0.0203 |        3001 | qjhllfore | qnxgujzjnk          | zauhaaiawp          | akefscbkd          | DT      | 123456789
      1 |    5 | 30000.00 | 0.1021 |        3001 | ktsusw    | ssmyesxrunluviddecq | tcimrdcwdebpcilrk   | uqzutabhhtksqk     | FP      | 123456789
      1 |    6 | 30000.00 | 0.0103 |        3001 | bchgvg    | aoxbwtlnuhlw        | ekevpcfjchru        | vjqqshkhoknudchfj  | AZ      | 123456789
      1 |    7 | 30000.00 | 0.1650 |        3001 | zghibn    | vfawnmetd           | dcmmylnszllbmhbwx   | snjkevkll          | VE      | 123456789
      1 |    8 | 30000.00 | 0.0165 |        3001 | vmqajf    | zhxahunwexxbakvhjvy | aipzwhdopilwt       | uwpmbibscobqvlak   | NX      | 123456789
      1 |    9 | 30000.00 | 0.1792 |        3001 | arqte     | dbigpwyqahrswnjqj   | dgipsjozngxiuibe    | iizakunnluqjseszzw | EJ      | 123456789
      1 |   10 | 30000.00 | 0.0347 |        3001 | pqdlosct  | icqchnjgnlskmpeluc  | gnwvprafxn          | wnsfwpgefrpzw      | RO      | 123456789
(10 行记录)






xu@ubuntu20:~/stealthdb/benchmark/benchbase/target/benchbase-postgres$ java -jar benchbase.jar -b tpcc -c config/postgres/sample_tpcc_config.xml --create=true --load=true --execute=true --dialects-export=/home/xu/out.sql
[INFO ] 2024-01-29 00:05:42,982 [main]  com.oltpbenchmark.DBWorkload main - ======================================================================

Benchmark:                       TPCC {com.oltpbenchmark.benchmarks.tpcc.TPCCBenchmark}
Configuration:                   config/postgres/sample_tpcc_config.xml
Type:                            POSTGRES
Driver:                          org.postgresql.Driver
URL:                             jdbc:postgresql://localhost:5432/test?sslmode=disable&ApplicationName=tpcc&reWriteBatchedInserts=true
Isolation:                       TRANSACTION_SERIALIZABLE
Batch Size:                      128
Scale Factor:                    1.0
Terminals:                       1
New Connection Per Txn:          false
Reconnect on Connection Failure: true

[INFO ] 2024-01-29 00:05:42,983 [main]  com.oltpbenchmark.DBWorkload main - ======================================================================
[INFO ] 2024-01-29 00:05:43,005 [main]  com.oltpbenchmark.DBWorkload main - Creating new TPCC database...
[INFO ] 2024-01-29 00:05:43,132 [main]  com.oltpbenchmark.DBWorkload main - Finished creating new TPCC database...
[INFO ] 2024-01-29 00:05:43,229 [main]  com.oltpbenchmark.DBWorkload main - Loading data into TPCC database...
[INFO ] 2024-01-29 00:05:43,232 [main]  com.oltpbenchmark.util.ThreadUtil runLoaderThreads - Creating a Thread Pool with a size of 2 to run 2 Loader Threads.  0 threads will be queued.
[INFO ] 2024-01-29 00:06:17,707 [main]  com.oltpbenchmark.util.ThreadUtil runLoaderThreads - Finished executing 2 Loader Threads [time=34.48s]
[INFO ] 2024-01-29 00:06:17,707 [main]  com.oltpbenchmark.DBWorkload main - Finished loading data into TPCC database...
[INFO ] 2024-01-29 00:06:17,708 [main]  com.oltpbenchmark.DBWorkload runWorkload - Creating 1 virtual terminals...
[INFO ] 2024-01-29 00:06:17,718 [main]  com.oltpbenchmark.DBWorkload runWorkload - Launching the TPCC Benchmark with 1 Phase...
[INFO ] 2024-01-29 00:06:17,720 [main]  com.oltpbenchmark.ThreadBench runRateLimitedMultiPhase - PHASE START :: [Workload=TPCC] [Serial=false] [Time=60] [WarmupTime=0] [Rate=10000.0] [Arrival=REGULAR] [Ratios=[45.0, 43.0, 4.0, 4.0, 4.0]] [ActiveWorkers=1]
[INFO ] 2024-01-29 00:06:17,721 [main]  com.oltpbenchmark.ThreadBench runRateLimitedMultiPhase - MEASURE :: Warmup complete, starting measurements.
[INFO ] 2024-01-29 00:07:17,721 [main]  com.oltpbenchmark.ThreadBench runRateLimitedMultiPhase - TERMINATE :: Waiting for all terminals to finish ..
[INFO ] 2024-01-29 00:07:17,722 [Thread-3]  com.oltpbenchmark.ThreadBench run - Starting WatchDogThread
[INFO ] 2024-01-29 00:07:17,742 [main]  com.oltpbenchmark.DBWorkload runWorkload - ======================================================================
[INFO ] 2024-01-29 00:07:17,742 [main]  com.oltpbenchmark.DBWorkload runWorkload - Rate limited reqs/s: Results(state=EXIT, nanoSeconds=60000031997, measuredRequests=36373) = 606.2163433815944 requests/sec (throughput), 603.1663450081077 requests/sec (goodput)
[INFO ] 2024-01-29 00:07:17,770 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output Raw data into file: tpcc_2024-01-29_00-07-17.raw.csv
[INFO ] 2024-01-29 00:07:18,024 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output samples into file: tpcc_2024-01-29_00-07-17.samples.csv
[INFO ] 2024-01-29 00:07:18,043 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output summary data into file: tpcc_2024-01-29_00-07-17.summary.json
[INFO ] 2024-01-29 00:07:18,048 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output DBMS parameters into file: tpcc_2024-01-29_00-07-17.params.json
[INFO ] 2024-01-29 00:07:18,054 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output DBMS metrics into file: tpcc_2024-01-29_00-07-17.metrics.json
[INFO ] 2024-01-29 00:07:18,060 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output benchmark config into file: tpcc_2024-01-29_00-07-17.config.xml
[INFO ] 2024-01-29 00:07:18,089 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output results into file: tpcc_2024-01-29_00-07-17.results.csv with window size 5
[INFO ] 2024-01-29 00:07:18,119 [main]  com.oltpbenchmark.DBWorkload writeHistograms - ======================================================================
[INFO ] 2024-01-29 00:07:18,119 [main]  com.oltpbenchmark.DBWorkload writeHistograms - Workload Histograms:

Completed Transactions:
com.oltpbenchmark.benchmarks.tpcc.procedures.NewOrder/01                         [16327] ********************************************************************************
com.oltpbenchmark.benchmarks.tpcc.procedures.Payment/02                          [15509] ***************************************************************************
com.oltpbenchmark.benchmarks.tpcc.procedures.OrderStatus/03                      [ 1443] *******
com.oltpbenchmark.benchmarks.tpcc.procedures.Delivery/04                         [ 1483] *******
com.oltpbenchmark.benchmarks.tpcc.procedures.StockLevel/05                       [ 1428] ******

Aborted Transactions:
com.oltpbenchmark.benchmarks.tpcc.procedures.NewOrder/01                         [ 184] ********************************************************************************

Rejected Transactions (Server Retry):
<EMPTY>

Rejected Transactions (Retry Different):
<EMPTY>

Unexpected SQL Errors:
<EMPTY>

Unknown Status Transactions:
<EMPTY>


[INFO ] 2024-01-29 00:07:18,119 [main]  com.oltpbenchmark.DBWorkload writeHistograms - ======================================================================








pg_prove -U postgres -d postgres /home/xu/stealthdb/test/encdb/run_test.sql




sudo -i -u postgres


psql


postgres@ubuntu20:~$ pg_prove -U postgres -d postgres /home/xu/stealthdb/test/encdb/run_test.sql
/home/xu/stealthdb/test/encdb/run_test.sql .. All 47 subtests passed 

Test Summary Report
-------------------
/home/xu/stealthdb/test/encdb/run_test.sql (Wstat: 0 Tests: 86 Failed: 39)
  Failed tests:  28-47, 49, 51, 53, 55, 57, 59, 61, 63, 65
                67, 69, 71, 73, 75, 77, 79, 81, 83, 85
  Parse errors: Tests out of sequence.  Found (1) but expected (2)
                Tests out of sequence.  Found (2) but expected (4)
                Tests out of sequence.  Found (3) but expected (5)
                Tests out of sequence.  Found (4) but expected (6)
                Tests out of sequence.  Found (5) but expected (7)
Displayed the first 5 of 48 TAP syntax errors.
Re-run prove with the -p option to see them all.
Files=1, Tests=86,  0 wallclock secs ( 0.02 usr  0.00 sys +  0.03 cusr  0.01 csys =  0.06 CPU)
Result: FAIL
postgres@ubuntu20:~$ pg_prove -U postgres -d postgres /home/xu/stealthdb/test/encdb/run_test.sql
/home/xu/stealthdb/test/encdb/run_test.sql .. ok     
All tests successful.
Files=1, Tests=47,  0 wallclock secs ( 0.01 usr  0.00 sys +  0.03 cusr  0.00 csys =  0.04 CPU)
Result: PASS
postgres@ubuntu20:~$ 






sudo apt-get purge openjdk-11-*

sudo apt-get autoremove
sudo apt install openjdk-21-jdk



xu@ubuntu20:~/stealthdb/benchmark/benchbase/target/benchbase-postgres$ java -jar benchbase.jar -b tpcc -c config/postgres/sample_tpcc_config.xml --create=true --load=true --execute=true
[INFO ] 2024-01-24 22:21:16,847 [main]  com.oltpbenchmark.DBWorkload main - ======================================================================

Benchmark:                       TPCC {com.oltpbenchmark.benchmarks.tpcc.TPCCBenchmark}
Configuration:                   config/postgres/sample_tpcc_config.xml
Type:                            POSTGRES
Driver:                          org.postgresql.Driver
URL:                             jdbc:postgresql://localhost:5432/test?sslmode=disable&ApplicationName=tpcc&reWriteBatchedInserts=true
Isolation:                       TRANSACTION_SERIALIZABLE
Batch Size:                      128
Scale Factor:                    1.0
Terminals:                       1
New Connection Per Txn:          false
Reconnect on Connection Failure: true

[INFO ] 2024-01-24 22:21:16,848 [main]  com.oltpbenchmark.DBWorkload main - ======================================================================
[INFO ] 2024-01-24 22:21:16,868 [main]  com.oltpbenchmark.DBWorkload main - Creating new TPCC database...
[INFO ] 2024-01-24 22:21:17,045 [main]  com.oltpbenchmark.DBWorkload main - Finished creating new TPCC database...
[INFO ] 2024-01-24 22:21:17,169 [main]  com.oltpbenchmark.DBWorkload main - Loading data into TPCC database...
[INFO ] 2024-01-24 22:21:17,172 [main]  com.oltpbenchmark.util.ThreadUtil runLoaderThreads - Creating a Thread Pool with a size of 2 to run 2 Loader Threads.  0 threads will be queued.
[INFO ] 2024-01-24 22:21:51,488 [main]  com.oltpbenchmark.util.ThreadUtil runLoaderThreads - Finished executing 2 Loader Threads [time=34.32s]
[INFO ] 2024-01-24 22:21:51,488 [main]  com.oltpbenchmark.DBWorkload main - Finished loading data into TPCC database...
[INFO ] 2024-01-24 22:21:51,488 [main]  com.oltpbenchmark.DBWorkload runWorkload - Creating 1 virtual terminals...
[INFO ] 2024-01-24 22:21:51,496 [main]  com.oltpbenchmark.DBWorkload runWorkload - Launching the TPCC Benchmark with 1 Phase...
[INFO ] 2024-01-24 22:21:51,498 [main]  com.oltpbenchmark.ThreadBench runRateLimitedMultiPhase - PHASE START :: [Workload=TPCC] [Serial=false] [Time=60] [WarmupTime=0] [Rate=10000.0] [Arrival=REGULAR] [Ratios=[45.0, 43.0, 4.0, 4.0, 4.0]] [ActiveWorkers=1]
[INFO ] 2024-01-24 22:21:51,498 [main]  com.oltpbenchmark.ThreadBench runRateLimitedMultiPhase - MEASURE :: Warmup complete, starting measurements.


[INFO ] 2024-01-24 22:22:51,498 [main]  com.oltpbenchmark.ThreadBench runRateLimitedMultiPhase - TERMINATE :: Waiting for all terminals to finish ..
[INFO ] 2024-01-24 22:22:51,499 [Thread-3]  com.oltpbenchmark.ThreadBench run - Starting WatchDogThread
[INFO ] 2024-01-24 22:22:51,518 [main]  com.oltpbenchmark.DBWorkload runWorkload - ======================================================================
[INFO ] 2024-01-24 22:22:51,518 [main]  com.oltpbenchmark.DBWorkload runWorkload - Rate limited reqs/s: Results(state=EXIT, nanoSeconds=60000088439, measuredRequests=35067) = 584.4491385317107 requests/sec (throughput), 581.9824755008642 requests/sec (goodput)
[INFO ] 2024-01-24 22:22:51,544 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output Raw data into file: tpcc_2024-01-24_22-22-51.raw.csv
[INFO ] 2024-01-24 22:22:51,755 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output samples into file: tpcc_2024-01-24_22-22-51.samples.csv
[INFO ] 2024-01-24 22:22:51,770 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output summary data into file: tpcc_2024-01-24_22-22-51.summary.json
[INFO ] 2024-01-24 22:22:51,776 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output DBMS parameters into file: tpcc_2024-01-24_22-22-51.params.json
[INFO ] 2024-01-24 22:22:51,780 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output DBMS metrics into file: tpcc_2024-01-24_22-22-51.metrics.json
[INFO ] 2024-01-24 22:22:51,785 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output benchmark config into file: tpcc_2024-01-24_22-22-51.config.xml
[INFO ] 2024-01-24 22:22:51,812 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output results into file: tpcc_2024-01-24_22-22-51.results.csv with window size 5
[INFO ] 2024-01-24 22:22:51,830 [main]  com.oltpbenchmark.DBWorkload writeHistograms - ======================================================================
[INFO ] 2024-01-24 22:22:51,830 [main]  com.oltpbenchmark.DBWorkload writeHistograms - Workload Histograms:

Completed Transactions:
com.oltpbenchmark.benchmarks.tpcc.procedures.NewOrder/01                         [15670] ********************************************************************************
com.oltpbenchmark.benchmarks.tpcc.procedures.Payment/02                          [15111] *****************************************************************************
com.oltpbenchmark.benchmarks.tpcc.procedures.OrderStatus/03                      [ 1386] *******
com.oltpbenchmark.benchmarks.tpcc.procedures.Delivery/04                         [ 1369] ******
com.oltpbenchmark.benchmarks.tpcc.procedures.StockLevel/05                       [ 1383] *******

Aborted Transactions:
com.oltpbenchmark.benchmarks.tpcc.procedures.NewOrder/01                         [ 149] ********************************************************************************

Rejected Transactions (Server Retry):
<EMPTY>

Rejected Transactions (Retry Different):
<EMPTY>

Unexpected SQL Errors:
<EMPTY>

Unknown Status Transactions:
<EMPTY>


[INFO ] 2024-01-24 22:22:51,830 [main]  com.oltpbenchmark.DBWorkload writeHistograms - ======================================================================








【第二个加密形式】
xu@ubuntu20:~/stealthdb/benchmark/benchbase/target/benchbase-postgres$ java -jar benchbase.jar -b tpcc -c config/postgres/sample_tpcc_config.xml --create=true --load=true --execute=true
[INFO ] 2024-01-24 22:30:19,585 [main]  com.oltpbenchmark.DBWorkload main - ======================================================================

Benchmark:                       TPCC {com.oltpbenchmark.benchmarks.tpcc.TPCCBenchmark}
Configuration:                   config/postgres/sample_tpcc_config.xml
Type:                            POSTGRES
Driver:                          org.postgresql.Driver
URL:                             jdbc:postgresql://localhost:5432/test?sslmode=disable&ApplicationName=tpcc&reWriteBatchedInserts=true
Isolation:                       TRANSACTION_SERIALIZABLE
Batch Size:                      128
Scale Factor:                    1.0
Terminals:                       1
New Connection Per Txn:          false
Reconnect on Connection Failure: true

[INFO ] 2024-01-24 22:30:19,586 [main]  com.oltpbenchmark.DBWorkload main - ======================================================================
[INFO ] 2024-01-24 22:30:19,607 [main]  com.oltpbenchmark.DBWorkload main - Creating new TPCC database...
[INFO ] 2024-01-24 22:30:19,721 [main]  com.oltpbenchmark.DBWorkload main - Finished creating new TPCC database...
[INFO ] 2024-01-24 22:30:19,825 [main]  com.oltpbenchmark.DBWorkload main - Loading data into TPCC database...
[INFO ] 2024-01-24 22:30:19,827 [main]  com.oltpbenchmark.util.ThreadUtil runLoaderThreads - Creating a Thread Pool with a size of 2 to run 2 Loader Threads.  0 threads will be queued.
[INFO ] 2024-01-24 22:30:54,450 [main]  com.oltpbenchmark.util.ThreadUtil runLoaderThreads - Finished executing 2 Loader Threads [time=34.62s]
[INFO ] 2024-01-24 22:30:54,450 [main]  com.oltpbenchmark.DBWorkload main - Finished loading data into TPCC database...
[INFO ] 2024-01-24 22:30:54,450 [main]  com.oltpbenchmark.DBWorkload runWorkload - Creating 1 virtual terminals...
[INFO ] 2024-01-24 22:30:54,457 [main]  com.oltpbenchmark.DBWorkload runWorkload - Launching the TPCC Benchmark with 1 Phase...
[INFO ] 2024-01-24 22:30:54,459 [main]  com.oltpbenchmark.ThreadBench runRateLimitedMultiPhase - PHASE START :: [Workload=TPCC] [Serial=false] [Time=60] [WarmupTime=0] [Rate=10000.0] [Arrival=REGULAR] [Ratios=[45.0, 43.0, 4.0, 4.0, 4.0]] [ActiveWorkers=1]
[INFO ] 2024-01-24 22:30:54,459 [main]  com.oltpbenchmark.ThreadBench runRateLimitedMultiPhase - MEASURE :: Warmup complete, starting measurements.
[INFO ] 2024-01-24 22:31:54,460 [main]  com.oltpbenchmark.ThreadBench runRateLimitedMultiPhase - TERMINATE :: Waiting for all terminals to finish ..
[INFO ] 2024-01-24 22:31:54,460 [Thread-3]  com.oltpbenchmark.ThreadBench run - Starting WatchDogThread
[INFO ] 2024-01-24 22:31:54,482 [main]  com.oltpbenchmark.DBWorkload runWorkload - ======================================================================
[INFO ] 2024-01-24 22:31:54,483 [main]  com.oltpbenchmark.DBWorkload runWorkload - Rate limited reqs/s: Results(state=EXIT, nanoSeconds=60000015334, measuredRequests=35019) = 583.6498508385531 requests/sec (throughput), 580.9331848661757 requests/sec (goodput)
[INFO ] 2024-01-24 22:31:54,513 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output Raw data into file: tpcc_2024-01-24_22-31-54.raw.csv
[INFO ] 2024-01-24 22:31:54,746 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output samples into file: tpcc_2024-01-24_22-31-54.samples.csv
[INFO ] 2024-01-24 22:31:54,761 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output summary data into file: tpcc_2024-01-24_22-31-54.summary.json
[INFO ] 2024-01-24 22:31:54,767 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output DBMS parameters into file: tpcc_2024-01-24_22-31-54.params.json
[INFO ] 2024-01-24 22:31:54,770 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output DBMS metrics into file: tpcc_2024-01-24_22-31-54.metrics.json
[INFO ] 2024-01-24 22:31:54,775 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output benchmark config into file: tpcc_2024-01-24_22-31-54.config.xml
[INFO ] 2024-01-24 22:31:54,802 [main]  com.oltpbenchmark.DBWorkload writeOutputs - Output results into file: tpcc_2024-01-24_22-31-54.results.csv with window size 5
[INFO ] 2024-01-24 22:31:54,822 [main]  com.oltpbenchmark.DBWorkload writeHistograms - ======================================================================
[INFO ] 2024-01-24 22:31:54,822 [main]  com.oltpbenchmark.DBWorkload writeHistograms - Workload Histograms:

Completed Transactions:
com.oltpbenchmark.benchmarks.tpcc.procedures.NewOrder/01                         [15698] ********************************************************************************
com.oltpbenchmark.benchmarks.tpcc.procedures.Payment/02                          [14919] ****************************************************************************
com.oltpbenchmark.benchmarks.tpcc.procedures.OrderStatus/03                      [ 1423] *******
com.oltpbenchmark.benchmarks.tpcc.procedures.Delivery/04                         [ 1435] *******
com.oltpbenchmark.benchmarks.tpcc.procedures.StockLevel/05                       [ 1381] *******

Aborted Transactions:
com.oltpbenchmark.benchmarks.tpcc.procedures.NewOrder/01                         [ 164] ********************************************************************************

Rejected Transactions (Server Retry):
<EMPTY>

Rejected Transactions (Retry Different):
<EMPTY>

Unexpected SQL Errors:
<EMPTY>

Unknown Status Transactions:
<EMPTY>


[INFO ] 2024-01-24 22:31:54,822 [main]  com.oltpbenchmark.DBWorkload writeHistograms - ======================================================================















从您提供的输出来看，您已经成功地使用 BenchBase 运行了 TPC-C 基准测试。这个输出提供了关于测试的详细信息和结果。我将解释主要部分的含义：

基准测试信息：

Benchmark: TPCC {com.oltpbenchmark.benchmarks.tpcc.TPCCBenchmark}：表明正在运行的是 TPC-C 基准测试。
Configuration: config/postgres/sample_tpcc_config.xml：指明使用的配置文件。
URL: jdbc:postgresql://localhost:5432/test：数据库的 JDBC 连接字符串。
其他行提供了关于事务隔离级别、批量大小、比例因子、终端数等的信息。
创建和加载数据：

创建新的 TPC-C 数据库并完成数据加载。这意味着您的数据库已经被正确配置并填充了 TPC-C 测试所需的数据。
执行基准测试：

Creating 1 virtual terminals...：创建了一个虚拟终端来运行测试。
Launching the TPCC Benchmark with 1 Phase...：启动了一个阶段的 TPC-C 基准测试。
基准测试结果：

提供了各种类型事务的完成次数，如 NewOrder, Payment, OrderStatus, Delivery, StockLevel。每种事务类型旁边的数字表示在测试期间执行该事务的次数。
Aborted Transactions 显示了中断的事务数量，这可能是由于各种原因，如死锁或数据冲突。
测试还生成了多个输出文件，包括原始数据 (raw.csv)、样本数据 (samples.csv)、摘要 (summary.json)、数据库参数 (params.json)、数据库指标 (metrics.json) 和基准测试配置 (config.xml)。
吞吐量和性能度量：

Rate limited reqs/s: Results 行显示了测试的吞吐量和性能度量，包括每秒处理的请求数。
直方图和事务分布：

最后，提供了一个直方图，显示了每种类型事务的分布情况。
总的来说，这些信息表明基准测试已成功运行，并提供了关于数据库在模拟的 TPC-C 环境下的性能的详细信息。这些数据可以用来分析数据库的性能，查找瓶颈，以及进行系统的优化和调整。






xu@ubuntu20:~/stealthdb/benchmark/benchbase/target/benchbase-postgres$ java -jar benchbase.jar -b tpcc -c config/postgres/sample_tpcc_config.xml --create=true --load=true --execute=true
[INFO ] 2024-01-24 22:16:05,416 [main]  com.oltpbenchmark.DBWorkload main - ======================================================================

Benchmark:                       TPCC {com.oltpbenchmark.benchmarks.tpcc.TPCCBenchmark}
Configuration:                   config/postgres/sample_tpcc_config.xml
Type:                            POSTGRES
Driver:                          org.postgresql.Driver
URL:                             jdbc:postgresql://localhost:5432/benchbase?sslmode=disable&ApplicationName=tpcc&reWriteBatchedInserts=true
Isolation:                       TRANSACTION_SERIALIZABLE
Batch Size:                      128
Scale Factor:                    1.0
Terminals:                       1
New Connection Per Txn:          false
Reconnect on Connection Failure: true

[INFO ] 2024-01-24 22:16:05,417 [main]  com.oltpbenchmark.DBWorkload main - ======================================================================
[INFO ] 2024-01-24 22:16:05,438 [main]  com.oltpbenchmark.DBWorkload main - Creating new TPCC database...
[ERROR] 2024-01-24 22:16:05,491 [main]  com.oltpbenchmark.DBWorkload main - Unexpected error when creating benchmark database tables.
org.postgresql.util.PSQLException: 致命错误: 用户 "admin" Password 认证失败
	at org.postgresql.core.v3.ConnectionFactoryImpl.doAuthentication(ConnectionFactoryImpl.java:693)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:203)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:444)
	at org.postgresql.Driver.connect(Driver.java:297)
	at java.sql/java.sql.DriverManager.getConnection(DriverManager.java:683)
	at java.sql/java.sql.DriverManager.getConnection(DriverManager.java:230)
	at com.oltpbenchmark.api.BenchmarkModule.makeConnection(BenchmarkModule.java:87)
	at com.oltpbenchmark.api.BenchmarkModule.createDatabase(BenchmarkModule.java:212)
	at com.oltpbenchmark.DBWorkload.runCreator(DBWorkload.java:727)
	at com.oltpbenchmark.DBWorkload.main(DBWorkload.java:463)
xu@ubuntu20:~/stealthdb/benchmark/benchbase/target/benchbase-postgres$ 










postgres@ubuntu20:~$ psql --version
psql (PostgreSQL) 10.23 (Ubuntu 10.23-2.pgdg20.04+1)
postgres@ubuntu20:~$ psql -U test -d test -f /home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql
用户 test 的口令：
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:1: 注意:  扩展 "encdb" 已经存在,跳过
CREATE EXTENSION
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:3: 注意:  表 "order_line" 不存在
DROP TABLE
CREATE TABLE
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:18: 注意:  表 "new_order" 不存在
DROP TABLE
CREATE TABLE
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:26: 注意:  表 "stock" 不存在
DROP TABLE
CREATE TABLE
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:48: 注意:  表 "oorder" 不存在
DROP TABLE
CREATE TABLE
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:62: 注意:  表 "history" 不存在
DROP TABLE
CREATE TABLE
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:74: 注意:  表 "customer" 不存在
DROP TABLE
CREATE TABLE
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:100: 注意:  表 "district" 不存在
DROP TABLE
CREATE TABLE
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:117: 注意:  表 "item" 不存在
DROP TABLE
CREATE TABLE
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema.sql:128: 注意:  表 "warehouse" 不存在
DROP TABLE
CREATE TABLE
CREATE INDEX
CREATE INDEX
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
postgres@ubuntu20:~$ psql -U test -d test -f /home/xu/stealthdb/benchmark/db_schemas/tpcc-schema_encrypted.sql
用户 test 的口令：
psql:/home/xu/stealthdb/benchmark/db_schemas/tpcc-schema_encrypted.sql:1: 注意:  扩展 "encdb" 已经存在,跳过
CREATE EXTENSION
DROP TABLE
CREATE TABLE
DROP TABLE
CREATE TABLE
DROP TABLE
CREATE TABLE
DROP TABLE
CREATE TABLE
DROP TABLE
CREATE TABLE
DROP TABLE
CREATE TABLE
DROP TABLE
CREATE TABLE
DROP TABLE
CREATE TABLE
DROP TABLE
CREATE TABLE
CREATE INDEX
CREATE INDEX
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE









理解你的请求，你想要将 BenchBase 项目使用 PostgreSQL 数据库的部分进行修改，以适应你的需求。以下是对这个操作流程的修改：

1. 克隆和构建 BenchBase 项目：
bash
Copy code
git clone --depth 1 https://github.com/cmu-db/benchbase.git
cd benchbase
./mvnw clean package -P postgres
这将生成包含 PostgreSQL 配置的 BenchBase 项目的构建文件。

2. 创建用户和数据库：
使用 psql 命令行工具创建用户和数据库：

bash
Copy code
psql
postgres=# CREATE USER test WITH PASSWORD 'password';
postgres=# CREATE DATABASE test;
postgres=# \c test;
test=# CREATE EXTENSION encdb;
3. 创建表和关系：
运行数据库模式创建脚本：

bash
Copy code
psql -U test -d test -f db_schemas/tpcc-schema.sql
# 或者
# psql -U test -d test -f db_schemas/tpcc-schema_encrypted.sql
4. 运行实验：
进入 BenchBase 项目的 target 目录：

bash
Copy code
cd target
tar xvzf benchbase-postgres.tgz
cd benchbase-postgres
运行 TPC-C 实验：

bash
Copy code
java -jar benchbase.jar -b tpcc -c config/postgres/sample_tpcc_config.xml --create=true --load=true --execute=true
这个命令会执行 TPC-C 基准测试，根据你的配置文件创建表、加载数据，并执行实验。

5. 查看所有选项：
你可以查看所有 BenchBase 命令行选项：

bash
Copy code
java -jar benchbase.jar -h
这将显示所有可用的命令行选项，方便你进行更多的自定义设置。

请确保你的系统上已经安装了 Maven（用于构建 BenchBase）和 PostgreSQL 数据库。



在 Ubuntu 20.04 上安装 Maven 的步骤如下：

更新软件包列表：

bash
Copy code
sudo apt update
安装 Maven：

bash
Copy code
sudo apt install maven
验证安装：

bash
Copy code
mvn -version




postgres@ubuntu20:~$ pg_prove -U postgres -d postgres /home/xu/stealthdb/test/encdb/run_test.sql
/home/xu/stealthdb/test/encdb/run_test.sql .. 1/47 
# Failed test 6: "enc_int4: AVG function (with rounding)"
#     Results differ beginning at row 1:
#         have: (1074790400)
#         want: (2)
# Looks like you failed 1 test of 47
/home/xu/stealthdb/test/encdb/run_test.sql .. Failed 1/47 subtests 

Test Summary Report
-------------------
/home/xu/stealthdb/test/encdb/run_test.sql (Wstat: 0 Tests: 47 Failed: 1)
  Failed test:  6
Files=1, Tests=47,  1 wallclock secs ( 0.02 usr  0.00 sys +  0.03 cusr  0.01 csys =  0.06 CPU)
Result: FAIL


xu@ubuntu20:~/stealthdb$ sudo -i -u postgres
postgres@ubuntu20:~$ psql
psql: 连接到套接字"/var/run/postgresql/.s.PGSQL.5432"上的服务器失败:没有那个文件或目录
	Is the server running locally and accepting connections on that socket?
postgres@ubuntu20:~$ 

sudo netstat -plunt | grep postgres
sudo: netstat：找不到命令

xu@ubuntu20:/var/run/postgresql$ sudo ss -plunt | grep postgres
tcp     LISTEN   0        224            127.0.0.1:5433           0.0.0.0:*      users:(("postgres",pid=35606,fd=3))                                            
xu@ubuntu20:/var/run/postgresql$ 


要在Ubuntu 20.04上安装PostgreSQL 10版本，包括服务器和扩展构建工具，你可以使用以下命令：

添加PostgreSQL的官方APT存储库:
首先，添加PostgreSQL的官方APT存储库，以确保你能安装最新的PostgreSQL版本。Ubuntu 20.04的默认存储库可能已经包含PostgreSQL 10，但添加官方存储库可以确保获取最新的更新和补丁。

bash
Copy code
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
更新软件包列表:
更新APT包列表以包含新添加的存储库。

bash
Copy code
sudo apt update
安装PostgreSQL 10及开发工具:
现在，你可以安装PostgreSQL 10和相应的开发包。

bash
Copy code
sudo apt-get install postgresql-10 postgresql-server-dev-10
这将安装PostgreSQL 10版本以及用于构建PostgreSQL扩展的开发工具。在执行这些步骤后，你应该能够使用PostgreSQL 10版本。


CXX  <=  enclave/enc_int32_ops.cpp
make[1]：nasm：命令未找到
make[1]: *** [enclave.mk:89：tools/oblvs_int32_ops.o] 错误 127
make[1]: 离开目录“/home/xu/stealthdb/src”
make: *** [Makefile:7：all] 错误 2






xu@ubuntu20:~/stealthdb$ sudo -i -u postgres
postgres@ubuntu20:~$ psql
psql (9.6.24)
输入 "help" 来获取帮助信息.

postgres=# CREATE EXTENSION encdb;
错误:  库 "/usr/lib/postgresql/9.6/lib/encdb.so"不兼容:版本不匹配
描述:  服务器版本是9.6，库的版本是10.0.



在 Ubuntu 20.04 上安装 PostgreSQL 9.6 的步骤如下：

更新软件包列表：

在终端中执行以下命令，以确保您的系统已更新到最新的软件包列表：

bash
Copy code
sudo apt update
安装 PostgreSQL 9.6：

Ubuntu 20.04 的默认软件源中可能不包含 PostgreSQL 9.6，但您可以使用 PostgreSQL 官方仓库获取它。以下是安装步骤：

添加 PostgreSQL 官方仓库的 APT 密钥：

bash
Copy code
sudo apt install wget ca-certificates
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
添加 PostgreSQL 9.6 仓库到软件源列表：

bash
Copy code
echo "deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main" | sudo tee /etc/apt/sources.list.d/pgdg.list
更新软件包列表：

bash
Copy code
sudo apt update
安装 PostgreSQL 9.6：

bash
Copy code
sudo apt install postgresql-9.6
初始化数据库并启动 PostgreSQL：

安装完成后，初始化 PostgreSQL 数据库并启动服务：

bash
Copy code
sudo pg_createcluster 9.6 main --start
这将创建并启动一个名为 "main" 的 PostgreSQL 集群。

设置密码：

默认情况下，PostgreSQL 安装后仅允许本地连接。您需要设置密码来访问数据库。

切换到 PostgreSQL 用户：

bash
Copy code
sudo -i -u postgres
使用 psql 命令登录 PostgreSQL：

bash
Copy code
psql
设置 postgres 用户密码：

sql
Copy code
ALTER USER postgres WITH PASSWORD 'your_password';
退出 psql：

sql
Copy code
\q
退出 PostgreSQL 用户：

bash
Copy code
exit
配置远程访问（可选）：

如果您需要从远程计算机访问 PostgreSQL 服务器，请进行以下配置：

编辑 PostgreSQL 配置文件：

bash
Copy code
sudo nano /etc/postgresql/9.6/main/pg_hba.conf
在文件的底部添加以下行，以允许所有 IP 地址连接到数据库。请根据您的安全需求调整。

plaintext
Copy code
host    all    all    0.0.0.0/0    md5
保存并退出文件。

重启 PostgreSQL 服务：

bash
Copy code
sudo service postgresql restart







在Ubuntu 20.04上安装PostgreSQL 9.6需要执行一系列的步骤，因为默认的Ubuntu 20.04的存储库可能不包含PostgreSQL 9.6版本。以下是安装步骤：

添加PostgreSQL存储库:
首先，你需要添加PostgreSQL官方存储库，因为Ubuntu 20.04默认存储库可能不提供9.6版本。

bash
Copy code
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
更新系统包列表:
执行更新以使新添加的存储库生效。

bash
Copy code
sudo apt update
安装PostgreSQL 9.6:
安装PostgreSQL 9.6版本。

bash
Copy code
sudo apt install postgresql-9.6
启动PostgreSQL服务:
PostgreSQL安装后，它应该会自动启动。你可以使用以下命令检查其状态或手动启动它。

bash
Copy code
sudo systemctl status postgresql.service  # 检查状态
sudo systemctl start postgresql.service   # 启动服务
切换到Postgres用户:
默认情况下，PostgreSQL创建一个名为postgres的用户。你需要切换到这个用户来进行操作。

bash
Copy code
sudo -i -u postgres
创建一个新的数据库用户和数据库（可选）:
你可以创建一个新的数据库用户和数据库。

bash
Copy code
createuser --interactive
createdb mydatabase
连接到PostgreSQL数据库（可选）:
使用以下命令连接到PostgreSQL。

bash
Copy code
psql



























xu@ubuntu20:~/桌面$ sudo apt-get --purge remove postgresql postgresql-server-dev-all
正在读取软件包列表... 完成
正在分析软件包的依赖关系树       
正在读取状态信息... 完成       
下列软件包是自动安装的并且现在不需要了：
  chromium-codecs-ffmpeg-extra gstreamer1.0-vaapi
  libgstreamer-plugins-bad1.0-0 libva-wayland2
使用'sudo apt autoremove'来卸载它(它们)。
下列软件包将被【卸载】：
  postgresql* postgresql-server-dev-all*
升级了 0 个软件包，新安装了 0 个软件包，要卸载 2 个软件包，有 252 个软件包未被升级。
解压缩后将会空出 165 kB 的空间。
您希望继续执行吗？ [Y/n] Y
(正在读取数据库 ... 系统当前共安装有 220573 个文件和目录。)
正在卸载 postgresql (12+214ubuntu0.1) ...
正在卸载 postgresql-server-dev-all (214ubuntu0.1) ...
正在处理用于 man-db (2.9.1-1) 的触发器 ...
xu@ubuntu20:~/桌面$ sudo apt-get autoremove
正在读取软件包列表... 完成
正在分析软件包的依赖关系树       
正在读取状态信息... 完成       
下列软件包将被【卸载】：
  chromium-codecs-ffmpeg-extra gstreamer1.0-vaapi
  libgstreamer-plugins-bad1.0-0 libva-wayland2
升级了 0 个软件包，新安装了 0 个软件包，要卸载 4 个软件包，有 252 个软件包未被升级。
解压缩后将会空出 2,255 kB 的空间。
您希望继续执行吗？ [Y/n] Y
(正在读取数据库 ... 系统当前共安装有 220548 个文件和目录。)
正在卸载 chromium-codecs-ffmpeg-extra (1:85.0.4183.83-0ubuntu0.20.04.3) ...
正在卸载 gstreamer1.0-vaapi:amd64 (1.16.2-2) ...
正在卸载 libgstreamer-plugins-bad1.0-0:amd64 (1.16.3-0ubuntu1.1) ...
正在卸载 libva-wayland2:amd64 (2.7.0-2) ...
正在处理用于 libc-bin (2.31-0ubuntu9.9) 的触发器 ...
xu@ubuntu20:~/桌面$ wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
OK
xu@ubuntu20:~/桌面$ sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
xu@ubuntu20:~/桌面$ sudo apt-get update
命中:2 http://security.ubuntu.com/ubuntu focal-security InRelease              
命中:1 http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal InRelease              
命中:3 http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-updates InRelease
命中:4 http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-backports InRelease
命中:5 https://download.01.org/intel-sgx/sgx_repo/ubuntu focal InRelease
获取:6 http://apt.postgresql.org/pub/repos/apt focal-pgdg InRelease [123 kB]
获取:7 http://apt.postgresql.org/pub/repos/apt focal-pgdg/main amd64 Packages [293 kB]
已下载 416 kB，耗时 4秒 (114 kB/s)
正在读取软件包列表... 完成
N: 鉴于仓库 'http://apt.postgresql.org/pub/repos/apt focal-pgdg InRelease' 不支持 'i386' 体系结构，跳过配置文件 'main/binary-i386/Packages' 的获取。
xu@ubuntu20:~/桌面$ sudo apt-get install postgresql-9.6 postgresql-server-dev-9.6
正在读取软件包列表... 完成
正在分析软件包的依赖关系树       
正在读取状态信息... 完成       
将会同时安装下列软件：
  postgresql-client-9.6 postgresql-contrib-9.6
建议安装：
  postgresql-doc-9.6 libdbd-pg-perl
下列【新】软件包将被安装：
  postgresql-9.6 postgresql-client-9.6 postgresql-contrib-9.6
  postgresql-server-dev-9.6
升级了 0 个软件包，新安装了 4 个软件包，要卸载 0 个软件包，有 260 个软件包未被升级。
需要下载 6,994 kB 的归档。
解压缩后会消耗 35.3 MB 的额外空间。
您希望继续执行吗？ [Y/n] Y
获取:1 http://apt.postgresql.org/pub/repos/apt focal-pgdg/main amd64 postgresql-client-9.6 amd64 9.6.24-5.pgdg20.04+1 [1,357 kB]
获取:2 http://apt.postgresql.org/pub/repos/apt focal-pgdg/main amd64 postgresql-9.6 amd64 9.6.24-5.pgdg20.04+1 [4,339 kB]
获取:3 http://apt.postgresql.org/pub/repos/apt focal-pgdg/main amd64 postgresql-contrib-9.6 amd64 9.6.24-5.pgdg20.04+1 [510 kB]
获取:4 http://apt.postgresql.org/pub/repos/apt focal-pgdg/main amd64 postgresql-server-dev-9.6 amd64 9.6.24-5.pgdg20.04+1 [788 kB]
已下载 6,994 kB，耗时 11秒 (662 kB/s)                                          
正在预设定软件包 ...
正在选中未选择的软件包 postgresql-client-9.6。
(正在读取数据库 ... 系统当前共安装有 220507 个文件和目录。)
准备解压 .../postgresql-client-9.6_9.6.24-5.pgdg20.04+1_amd64.deb  ...
正在解压 postgresql-client-9.6 (9.6.24-5.pgdg20.04+1) ...
正在选中未选择的软件包 postgresql-9.6。
准备解压 .../postgresql-9.6_9.6.24-5.pgdg20.04+1_amd64.deb  ...
正在解压 postgresql-9.6 (9.6.24-5.pgdg20.04+1) ...
正在选中未选择的软件包 postgresql-contrib-9.6。
准备解压 .../postgresql-contrib-9.6_9.6.24-5.pgdg20.04+1_amd64.deb  ...
正在解压 postgresql-contrib-9.6 (9.6.24-5.pgdg20.04+1) ...
正在选中未选择的软件包 postgresql-server-dev-9.6。
准备解压 .../postgresql-server-dev-9.6_9.6.24-5.pgdg20.04+1_amd64.deb  ...
正在解压 postgresql-server-dev-9.6 (9.6.24-5.pgdg20.04+1) ...
正在设置 postgresql-client-9.6 (9.6.24-5.pgdg20.04+1) ...
正在设置 postgresql-server-dev-9.6 (9.6.24-5.pgdg20.04+1) ...
正在设置 postgresql-9.6 (9.6.24-5.pgdg20.04+1) ...
Creating new PostgreSQL cluster 9.6/main ...
/usr/lib/postgresql/9.6/bin/initdb -D /var/lib/postgresql/9.6/main --auth-local peer --auth-host md5
属于此数据库系统的文件宿主为用户 "postgres".
此用户也必须为服务器进程的宿主.
数据库簇将使用本地化语言 "zh_CN.UTF-8"进行初始化.
默认的数据库编码已经相应的设置为 "UTF8".
initdb: 无法为本地化语言环境"zh_CN.UTF-8"找到合适的文本搜索配置
缺省的文本搜索配置将会被设置到"simple"

禁止为数据页生成校验和.

修复已存在目录 /var/lib/postgresql/9.6/main 的权限 ... 成功
正在创建子目录 ... 成功
选择默认最大联接数 (max_connections) ... 100
选择默认共享缓冲区大小 (shared_buffers) ... 128MB
selecting default timezone ... Asia/Shanghai
选择动态共享内存实现 ......posix
创建配置文件 ... 成功
正在运行自举脚本 ...成功
正在执行自举后初始化 ...成功
同步数据到磁盘...成功

成功。您现在可以用下面的命令开启数据库服务器：

    /usr/lib/postgresql/9.6/bin/pg_ctl -D /var/lib/postgresql/9.6/main -l logfile start

Ver Cluster Port Status Owner    Data directory               Log file
9.6 main    5433 down   postgres /var/lib/postgresql/9.6/main /var/log/postgresql/postgresql-9.6-main.log
正在设置 postgresql-contrib-9.6 (9.6.24-5.pgdg20.04+1) ...
正在处理用于 postgresql-common (214ubuntu0.1) 的触发器 ...
Building PostgreSQL dictionaries from installed myspell/hunspell packages...
  en_us
Removing obsolete dictionary files:
xu@ubuntu20:~/桌面$ sudo systemctl start postgresql
xu@ubuntu20:~/桌面$ psql --version
psql (PostgreSQL) 12.17 (Ubuntu 12.17-0ubuntu0.20.04.1)






postgres=# CREATE EXTENSION encdb;
错误:  无法打开扩展控制文件 "/usr/share/postgresql/9.6/extension/encdb.control": 没有那个文件或目录
postgres=# 



xu@ubuntu20:~/桌面$ psql --version
psql (PostgreSQL) 12.17 (Ubuntu 12.17-0ubuntu0.20.04.1)
xu@ubuntu20:~/桌面$ sudo apt-get --purge remove postgresql-12 postgresql-server-dev-12
正在读取软件包列表... 完成
正在分析软件包的依赖关系树       
正在读取状态信息... 完成       
下列软件包将被【卸载】：
  postgresql-12* postgresql-server-dev-12*
升级了 0 个软件包，新安装了 0 个软件包，要卸载 2 个软件包，有 258 个软件包未被升级。
解压缩后将会空出 46.9 MB 的空间。
您希望继续执行吗？ [Y/n] Y
(正在读取数据库 ... 系统当前共安装有 221926 个文件和目录。)
正在卸载 postgresql-12 (12.17-0ubuntu0.20.04.1) ...
update-alternatives: 使用 /usr/share/postgresql/9.6/man/man1/postmaster.1.gz 来在自动模式中提供 /usr/share/man/man1/postmaster.1.gz (postmaster.1.gz)
正在卸载 postgresql-server-dev-12 (12.17-0ubuntu0.20.04.1) ...
正在处理用于 postgresql-common (214ubuntu0.1) 的触发器 ...
Building PostgreSQL dictionaries from installed myspell/hunspell packages...
  en_us
Removing obsolete dictionary files:
(正在读取数据库 ... 系统当前共安装有 219733 个文件和目录。)
正在清除 postgresql-12 (12.17-0ubuntu0.20.04.1) 的配置文件 ...
Dropping cluster main...
dpkg: 警告: 卸载 postgresql-12 时，目录 /usr/share/postgresql/12/extension 非空，因而不会删除该目录
正在处理用于 postgresql-common (214ubuntu0.1) 的触发器 ...
Building PostgreSQL dictionaries from installed myspell/hunspell packages...
  en_us
Removing obsolete dictionary files:
xu@ubuntu20:~/桌面$ psql --version
psql (PostgreSQL) 12.17 (Ubuntu 12.17-0ubuntu0.20.04.1)
xu@ubuntu20:~/桌面$ sudo -u postgres psql
psql (12.17 (Ubuntu 12.17-0ubuntu0.20.04.1), server 9.6.24)
Type "help" for help.

postgres=# CREATE EXTENSION encdb;
错误:  无法打开扩展控制文件 "/usr/share/postgresql/9.6/extension/encdb.control": 没有那个文件或目录
postgres=# 



要在 Ubuntu 上卸载已安装的 PostgreSQL 12 并安装 PostgreSQL 9.6，您可以按照以下步骤操作：

卸载 PostgreSQL 12
停止 PostgreSQL 服务：

bash
Copy code
sudo systemctl stop postgresql
卸载 PostgreSQL 12：

bash
Copy code
sudo apt-get --purge remove postgresql postgresql-server-dev-all
这将移除 PostgreSQL 12 和相关的开发文件。请注意，使用 --purge 参数会删除配置文件和数据目录。

清理系统：

bash
Copy code
sudo apt-get autoremove
这将删除所有不再需要的包。

可选：备份数据：
如果您有重要数据在 PostgreSQL 12 的数据库中，建议在卸载前进行备份。

安装 PostgreSQL 9.6
添加 PostgreSQL 9.6 的官方仓库：
PostgreSQL 9.6 可能不在 Ubuntu 的默认仓库中，因此您需要添加 PostgreSQL 的官方仓库。

添加 GPG 密钥：

bash
Copy code
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
添加仓库：

bash
Copy code
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
更新包列表：

bash
Copy code
sudo apt-get update
安装 PostgreSQL 9.6：

bash
Copy code
sudo apt-get install postgresql-9.6 postgresql-server-dev-9.6
这将安装 PostgreSQL 9.6 及其开发文件。

启动 PostgreSQL 服务：

bash
Copy code
sudo systemctl start postgresql
验证安装：
检查 PostgreSQL 9.6 是否正确安装：

bash
Copy code
psql --version
或者尝试连接到 PostgreSQL 数据库：

bash
Copy code
sudo -u postgres psql















# Auto detect text files and perform LF normalization
* text=auto
postgres=# CREATE EXTENSION encdb;
ERROR:  could not load library "/usr/lib/postgresql/12/lib/encdb.so": /usr/lib/postgresql/12/lib/encdb.so: undefined symbol: get_float4_infinity




xu@ubuntu20:/opt/intel/sgxsdk/SampleCode/SampleEnclave$ sudo make
[sudo] xu 的密码： 
对不起，请重试。
[sudo] xu 的密码： 
make[1]: 进入目录“/opt/intel/sgxsdk/SampleCode/SampleEnclave”
GEN  =>  App/Enclave_u.h
CC   <=  App/Enclave_u.c
CXX  <=  App/App.cpp
CXX  <=  App/Edger8rSyntax/Types.cpp
CXX  <=  App/Edger8rSyntax/Pointers.cpp
CXX  <=  App/Edger8rSyntax/Arrays.cpp
CXX  <=  App/Edger8rSyntax/Functions.cpp
CXX  <=  App/TrustedLibrary/Thread.cpp
CXX  <=  App/TrustedLibrary/Libcxx.cpp
CXX  <=  App/TrustedLibrary/Libc.cpp
LINK =>  app
GEN  =>  Enclave/Enclave_t.h
CC   <=  Enclave/Enclave_t.c
CXX  <=  Enclave/Edger8rSyntax/Arrays.cpp
CXX  <=  Enclave/Edger8rSyntax/Functions.cpp
CXX  <=  Enclave/Edger8rSyntax/Pointers.cpp
CXX  <=  Enclave/Edger8rSyntax/Types.cpp
CXX  <=  Enclave/Enclave.cpp
CXX  <=  Enclave/TrustedLibrary/Libc.cpp
In file included from /opt/intel/sgxsdk/include/libcxx/cwchar:110,
                 from /opt/intel/sgxsdk/include/libcxx/__string:60,
                 from /opt/intel/sgxsdk/include/libcxx/string_view:179,
                 from /opt/intel/sgxsdk/include/libcxx/string:511,
                 from Enclave/TrustedLibrary/Libcxx.cpp:34:
/opt/intel/sgxsdk/include/libcxx/__support/sgx/support.h:6:8: warning: redundant redeclaration of ‘size_t mbsnrtowcs(wchar_t*, const char**, size_t, size_t, mbstate_t*)’ in same scope [-Wredundant-decls]
    6 | size_t mbsnrtowcs(wchar_t *dst, const char **src,
      |        ^~~~~~~~~~
In file included from /opt/intel/sgxsdk/include/libcxx/iosfwd:95,
                 from /opt/intel/sgxsdk/include/libcxx/__debug:17,
                 from /opt/intel/sgxsdk/include/libcxx/utility:206,
                 from /opt/intel/sgxsdk/include/libcxx/algorithm:652,
                 from /opt/intel/sgxsdk/include/libcxx/__string:57,
                 from /opt/intel/sgxsdk/include/libcxx/string_view:179,
                 from /opt/intel/sgxsdk/include/libcxx/string:511,
                 from Enclave/TrustedLibrary/Libcxx.cpp:34:
/opt/intel/sgxsdk/include/tlibc/wchar.h:132:27: note: previous declaration of ‘size_t mbsnrtowcs(wchar_t*, const char**, size_t, size_t, mbstate_t*)’
  132 | size_t      _TLIBC_CDECL_ mbsnrtowcs(wchar_t *__restrict, const char **__restrict, size_t, size_t, mbstate_t *__restrict);
      |                           ^~~~~~~~~~
In file included from /opt/intel/sgxsdk/include/libcxx/cwchar:110,
                 from /opt/intel/sgxsdk/include/libcxx/__string:60,
                 from /opt/intel/sgxsdk/include/libcxx/string_view:179,
                 from /opt/intel/sgxsdk/include/libcxx/string:511,
                 from Enclave/TrustedLibrary/Libcxx.cpp:34:
/opt/intel/sgxsdk/include/libcxx/__support/sgx/support.h:8:8: warning: redundant redeclaration of ‘size_t wcsnrtombs(char*, const wchar_t**, size_t, size_t, mbstate_t*)’ in same scope [-Wredundant-decls]
    8 | size_t wcsnrtombs(char *dst, const wchar_t **src,
      |        ^~~~~~~~~~
In file included from /opt/intel/sgxsdk/include/libcxx/iosfwd:95,
                 from /opt/intel/sgxsdk/include/libcxx/__debug:17,
                 from /opt/intel/sgxsdk/include/libcxx/utility:206,
                 from /opt/intel/sgxsdk/include/libcxx/algorithm:652,
                 from /opt/intel/sgxsdk/include/libcxx/__string:57,
                 from /opt/intel/sgxsdk/include/libcxx/string_view:179,
                 from /opt/intel/sgxsdk/include/libcxx/string:511,
                 from Enclave/TrustedLibrary/Libcxx.cpp:34:
/opt/intel/sgxsdk/include/tlibc/wchar.h:131:27: note: previous declaration of ‘size_t wcsnrtombs(char*, const wchar_t**, size_t, size_t, mbstate_t*)’
  131 | size_t      _TLIBC_CDECL_ wcsnrtombs(char *__restrict, const wchar_t **__restrict, size_t, size_t, mbstate_t *__restrict);
      |                           ^~~~~~~~~~
CXX  <=  Enclave/TrustedLibrary/Libcxx.cpp
CXX  <=  Enclave/TrustedLibrary/Thread.cpp
LINK =>  enclave.so
There is no enclave test key<Enclave_private_test.pem>.
The project will generate a key<Enclave_private_test.pem> for test.
Generating RSA private key, 3072 bit long modulus (2 primes)
..........++++
....................................................................................................................................................................++++
e is 3 (0x03)
<EnclaveConfiguration>
    <ProdID>0</ProdID>
    <ISVSVN>0</ISVSVN>
    <StackMaxSize>0x40000</StackMaxSize>
    <HeapMaxSize>0x100000</HeapMaxSize>
    <TCSNum>10</TCSNum>
    <TCSPolicy>1</TCSPolicy>
    <!-- Recommend changing 'DisableDebug' to 1 to make the enclave undebuggable for enclave release -->
    <DisableDebug>0</DisableDebug>
    <MiscSelect>0</MiscSelect>
    <MiscMask>0xFFFFFFFF</MiscMask>
</EnclaveConfiguration>
tcs_num 10, tcs_max_num 10, tcs_min_pool 1
INFO: Enclave configuration 'MiscSelect' and 'MiscSelectMask' will prevent enclave from using dynamic features. To use the dynamic features on SGX2 platform, suggest to set MiscMask[0]=0 and MiscSelect[0]=1.
The required memory is 4169728B.
The required memory is 0x3fa000, 4072 KB.
handle_compatible_metadata: Overwrite with metadata version 0x100000004
Succeed.
SIGN =>  enclave.signed.so
The project has been built in debug hardware mode.
make[1]: 离开目录“/opt/intel/sgxsdk/SampleCode/SampleEnclave”
xu@ubuntu20:/opt/intel/sgxsdk/SampleCode/SampleEnclave$ ./app
Error: Unexpected error occurred.
Enter a character before exit ...

